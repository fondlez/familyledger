<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>familyledger.possessions &#8212; Family Ledger Documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/cli.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          Family Ledger</a>
        <span class="navbar-text navbar-version pull-left"><b>0.2.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../contents.html">Contents</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../web.html">Tutorial 1: Viewing items in your web browser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../output_file.html">Tutorial 2: Viewing items from a file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../output_console.html">Tutorial 3: Viewing items in the console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../search_console.html">Tutorial 4: Searching items in the console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../views.html">Views Explained</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../commandline_examples.html">More Command Line Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference_ledger.html">Ledger - Program Arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference_ledger_web.html">Ledger Web - Program Arguments</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bugs.html">Known Issues and Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bugs.html#reporting-bugs">Reporting Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../news.html">News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../author.html">Author</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../third_party.html">Credits</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for familyledger.possessions</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A module responsible for parsing saved World of Warcraft item data per account.</span>

<span class="sd">This module currently only makes use of the user data from the vanilla patch  </span>
<span class="sd">1.12 World of Warcraft (WoW) addon called `Possessions`_. WoW addons and saved </span>
<span class="sd">data are written in the Lua language. Therefore, this module uses a third-party </span>
<span class="sd">Lua expression parser (`slpp`_) to get data into Python. The data is flattened </span>
<span class="sd">and reformatted for higher level processing by users of this module.</span>

<span class="sd">.. _Possessions: https://github.com/Road-block/Possessions</span>
<span class="sd">.. _slpp: https://github.com/SirAnthony/slpp</span>

<span class="sd">Copyright (C) 2020, fondlez, fondlez at protonmail.com</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">abc</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="n">slpp</span> <span class="kn">import</span> <span class="nn">slpp</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="n">utils</span><span class="o">.</span><span class="n">_i18n</span> <span class="kn">import</span> <span class="nn">n_</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="n">utils</span> <span class="kn">import</span> <span class="nn">_path</span>


<span class="n">CONTAINER_NAME</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;inventory&#39;</span><span class="p">,</span>  <span class="c1"># bag: the backpack - your intial 16 slots container</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;bank&#39;</span><span class="p">,</span>
    <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;player&#39;</span><span class="p">,</span>
    <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;mail&#39;</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;bag01&#39;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;bag02&#39;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;bag03&#39;</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;bag04&#39;</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;bag05&#39;</span><span class="p">,</span>  <span class="c1"># bank: bag</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;bag06&#39;</span><span class="p">,</span>  <span class="c1"># bank: bag</span>
    <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;bag07&#39;</span><span class="p">,</span>  <span class="c1"># bank: bag</span>
    <span class="mi">8</span><span class="p">:</span> <span class="s1">&#39;bag08&#39;</span><span class="p">,</span>  <span class="c1"># bank: bag</span>
    <span class="mi">9</span><span class="p">:</span> <span class="s1">&#39;bag09&#39;</span><span class="p">,</span>  <span class="c1"># bank: bag</span>
    <span class="mi">10</span><span class="p">:</span> <span class="s1">&#39;bag10&#39;</span><span class="p">,</span>  <span class="c1"># bank: bag</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;Mapping from raw container index to container name.&quot;&quot;&quot;</span>

<span class="n">ITEM_INDEX</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;item_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;item_name&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;item_icon&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;item_quantity&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;item_rarity&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;Reverse mapping from item property to raw item index.&quot;&quot;&quot;</span>

<span class="n">ITEM_RARITY</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;0-Poor&#39;</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;1-Common&#39;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;2-Uncommon&#39;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;3-Rare&#39;</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;4-Epic&#39;</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;5-Legendary&#39;</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;6-Artifact&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;Mapping from raw item rarity to rarity name.&quot;&quot;&quot;</span>

<span class="n">POSSESSIONS_VAR</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^\s*PossessionsData = &#39;</span>
<span class="sd">&quot;&quot;&quot;Matching pattern for unneeded variable assignment in the Lua text input.&quot;&quot;&quot;</span>


<span class="n">ItemRecord</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s1">&#39;ItemRecord&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="n">n_</span><span class="p">(</span><span class="s1">&#39;realm&#39;</span><span class="p">),</span> <span class="n">n_</span><span class="p">(</span><span class="s1">&#39;character&#39;</span><span class="p">),</span> <span class="n">n_</span><span class="p">(</span><span class="s1">&#39;faction&#39;</span><span class="p">),</span> <span class="n">n_</span><span class="p">(</span><span class="s1">&#39;gold&#39;</span><span class="p">),</span> 
        <span class="n">n_</span><span class="p">(</span><span class="s1">&#39;container&#39;</span><span class="p">),</span> <span class="n">n_</span><span class="p">(</span><span class="s1">&#39;slot_id&#39;</span><span class="p">),</span> <span class="n">n_</span><span class="p">(</span><span class="s1">&#39;item_id&#39;</span><span class="p">),</span> <span class="n">n_</span><span class="p">(</span><span class="s1">&#39;item_name&#39;</span><span class="p">),</span> 
        <span class="n">n_</span><span class="p">(</span><span class="s1">&#39;item_icon&#39;</span><span class="p">),</span> <span class="n">n_</span><span class="p">(</span><span class="s1">&#39;item_quantity&#39;</span><span class="p">),</span> <span class="n">n_</span><span class="p">(</span><span class="s1">&#39;item_rarity&#39;</span><span class="p">)])</span>
<span class="sd">&quot;&quot;&quot;Data type capturing the raw item data from the Possessions addon.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="check_possessions"><a class="viewcode-back" href="../../familyledger.html#familyledger.possessions.check_possessions">[docs]</a><span class="k">def</span> <span class="nf">check_possessions</span><span class="p">(</span><span class="n">wowpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks for the existence of Possessions addon data files.</span>

<span class="sd">    Args:</span>
<span class="sd">        wowpath (str): path to WoW folder.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if files found, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">find_possessions</span><span class="p">(</span><span class="n">wowpath</span><span class="p">)</span>
    <span class="n">empty</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">empty</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">empty</span></div>


<div class="viewcode-block" id="find_possessions"><a class="viewcode-back" href="../../familyledger.html#familyledger.possessions.find_possessions">[docs]</a><span class="k">def</span> <span class="nf">find_possessions</span><span class="p">(</span><span class="n">wowpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the path information for the Possessions addon raw data files.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        wowpath (str): path to WoW folder.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        :obj:`types.GeneratorType` of :obj:`str`: paths matching Possessions </span>
<span class="sd">        addon data files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">_path</span><span class="o">.</span><span class="n">gen_find_file</span><span class="p">(</span>
        <span class="s1">&#39;Possessions.lua&#39;</span><span class="p">,</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wowpath</span><span class="p">,</span> <span class="s1">&#39;WTF&#39;</span><span class="p">,</span> <span class="s1">&#39;Account&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="gen_itemrecord"><a class="viewcode-back" href="../../familyledger.html#familyledger.possessions.gen_itemrecord">[docs]</a><span class="k">def</span> <span class="nf">gen_itemrecord</span><span class="p">(</span><span class="n">account_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Yields item data for output.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        account_data (dict): converted item data for all characters.</span>
<span class="sd">    </span>
<span class="sd">    Yields:</span>
<span class="sd">        :obj:`ItemRecord`: individual item information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filter_for_realms</span><span class="p">(</span><span class="n">account_data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">realm</span><span class="p">,</span> <span class="n">characters</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">account_data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">for</span> <span class="n">character</span><span class="p">,</span> <span class="n">attributes</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">characters</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">containers</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">container_id</span><span class="p">,</span> <span class="n">container</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">containers</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">container_name</span> <span class="o">=</span> <span class="n">CONTAINER_NAME</span><span class="p">[</span><span class="n">container_id</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">slot_id</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">ItemRecord</span><span class="p">(</span>
                        <span class="n">realm</span><span class="p">,</span>
                        <span class="n">character</span><span class="p">,</span>
                        <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;faction&#39;</span><span class="p">],</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;money&#39;</span><span class="p">]),</span>
                        <span class="n">container_name</span><span class="p">,</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">slot_id</span><span class="p">),</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ITEM_INDEX</span><span class="p">[</span><span class="s1">&#39;item_id&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ITEM_INDEX</span><span class="p">[</span><span class="s1">&#39;item_name&#39;</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ITEM_INDEX</span><span class="p">[</span><span class="s1">&#39;item_icon&#39;</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ITEM_INDEX</span><span class="p">[</span><span class="s1">&#39;item_quantity&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)),</span>
                        <span class="n">ITEM_RARITY</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ITEM_INDEX</span><span class="p">[</span><span class="s1">&#39;item_rarity&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
                    <span class="k">yield</span> <span class="n">record</span></div>


<div class="viewcode-block" id="filter_for_realms"><a class="viewcode-back" href="../../familyledger.html#familyledger.possessions.filter_for_realms">[docs]</a><span class="k">def</span> <span class="nf">filter_for_realms</span><span class="p">(</span><span class="n">account_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Filters out non-realm, non-item information from the raw data.</span>
<span class="sd">    </span>
<span class="sd">    Args: </span>
<span class="sd">        account_data (dict): Possessions addon data which includes non-item data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;config&#39;</span> <span class="ow">in</span> <span class="n">account_data</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">account_data</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="read"><a class="viewcode-back" href="../../familyledger.html#familyledger.possessions.read">[docs]</a><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reads a data file containing a Lua expression and returns item data.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        filename (str): data file containing a Lua expression.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :obj:`types.GeneratorType`: generator of :obj:`ItemRecord` item</span>
<span class="sd">        information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf_8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">lua_file</span><span class="p">:</span>
        <span class="n">lua_data</span> <span class="o">=</span> <span class="n">lua_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">account_data</span> <span class="o">=</span> <span class="n">lua_to_python</span><span class="p">(</span><span class="n">lua_data</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_data</span><span class="p">,</span> <span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gen_itemrecord</span><span class="p">(</span><span class="n">account_data</span><span class="p">)</span></div>


<div class="viewcode-block" id="lua_to_python"><a class="viewcode-back" href="../../familyledger.html#familyledger.possessions.lua_to_python">[docs]</a><span class="k">def</span> <span class="nf">lua_to_python</span><span class="p">(</span><span class="n">lua_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Translates Lua data to a Python expression and evaluates it.</span>
<span class="sd">    </span>
<span class="sd">    Item data in the Possessions data file is in this format::</span>
<span class="sd">    </span>
<span class="sd">        PossessionsData = {</span>
<span class="sd">            [&quot;Kronos&quot;] = {</span>
<span class="sd">                [&quot;harrypotter&quot;] = {</span>
<span class="sd">                    [&quot;items&quot;] = {</span>
<span class="sd">                        [1] = {</span>
<span class="sd">                            [1] = {</span>
<span class="sd">                                [1] = &quot;Thorium Lockbox&quot;,</span>
<span class="sd">                                [2] = &quot;Interface\\Icons\\INV_Misc_OrnateBox&quot;,</span>
<span class="sd">                                [3] = 1,</span>
<span class="sd">                                [4] = 2,</span>
<span class="sd">                                [0] = &quot;5759&quot;,</span>
<span class="sd">                            },</span>
<span class="sd">                            ...</span>
<span class="sd">    </span>
<span class="sd">    The &#39;PossessionsData = &#39; portion, indicating the start of a Lua statement </span>
<span class="sd">    of a variable assignment, is not required and would cause an error. Only the</span>
<span class="sd">    right hand side of the assignment, i.e. the Lua expression is needed. This</span>
<span class="sd">    function translates the Lua input into a Python expression, evaluates it</span>
<span class="sd">    and so produces Python item data in its &#39;raw&#39; format.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        lua_data (str): text containing a Lua statement.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: item data in raw format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lua_expression</span> <span class="o">=</span> <span class="n">lua_statement_to_expression</span><span class="p">(</span><span class="n">lua_data</span><span class="p">)</span>
    <span class="n">lua</span> <span class="o">=</span> <span class="n">slpp</span><span class="o">.</span><span class="n">SLPP</span><span class="p">()</span>
    <span class="n">python_data</span> <span class="o">=</span> <span class="n">lua</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">lua_expression</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">python_data</span></div>


<div class="viewcode-block" id="lua_statement_to_expression"><a class="viewcode-back" href="../../familyledger.html#familyledger.possessions.lua_statement_to_expression">[docs]</a><span class="k">def</span> <span class="nf">lua_statement_to_expression</span><span class="p">(</span><span class="n">lua_statement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts the Lua text to a Lua expression.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        lua_statement (str): Lua statement containing a single known variable</span>
<span class="sd">            assignment.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        str: text containing a Lua expression.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lua_expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">POSSESSIONS_VAR</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">lua_statement</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lua_expression</span></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, fondlez.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>